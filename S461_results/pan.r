#30/04/2021   Ivan Martin Hernandez
#Script that analize the JSON with th data of the AB PDB generated by the perl script "AB_SAbDab_sumarize.pl"

############################
# Preparation of the data

# Take the file --> "" and process it with bash command before use it

#   cat Id50c08_ok1merNCL.txt |sed 's/  */ /g' >Id50c08_ok1merNCL_2.txt
#   cat Id50c08_ok1merNCL_2.txt |cut -d " " -f1-26 > Id50c08_ok1merNCL.txt





############################





#Libraries
library(ggplot2)
library(ggpubr)
theme_set(theme_pubr())
library(dplyr)
library(stringr)
library(reshape2)
library(RColorBrewer)
library(cowplot)
library(ggpmisc)



#################
# Funciones
#################

mode <- function(x) {
  return(as.numeric(names(which.max(table(x)))))
}



# Multiple plot function
#
# ggplot objects can be passed in ..., or to plotlist (as a list of ggplot objects)
# - cols:   Number of columns in layout
# - layout: A matrix specifying the layout. If present, 'cols' is ignored.
#
# If the layout is something like matrix(c(1,2,3,3), nrow=2, byrow=TRUE),
# then plot 1 will go in the upper left, 2 will go in the upper right, and
# 3 will go all the way across the bottom.
#
multiplot <- function(..., plotlist=NULL, file, cols=1, layout=NULL) {
  library(grid)
  
  # Make a list from the ... arguments and plotlist
  plots <- c(list(...), plotlist)
  
  numPlots = length(plots)
  
  # If layout is NULL, then use 'cols' to determine layout
  if (is.null(layout)) {
    # Make the panel
    # ncol: Number of columns of plots
    # nrow: Number of rows needed, calculated from # of cols
    layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
                     ncol = cols, nrow = ceiling(numPlots/cols))
  }
  
  if (numPlots==1) {
    print(plots[[1]])
    
  } else {
    # Set up the page
    grid.newpage()
    pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))
    
    # Make each plot, in the correct location
    for (i in 1:numPlots) {
      # Get the i,j matrix positions of the regions that contain this subplot
      matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))
      
      print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
                                      layout.pos.col = matchidx$col))
    }
  }
}


corr_eqn <- function(x,y, digits = 2) {
  corr_coef <- round(cor(x, y), digits = digits)
  paste("r = ", corr_coef)
}








###########################################################
###########################################################
###########################################################
#     RESULTS PUCCI BENCHMARK
#####################*****######################################
###########################################################
###########################################################
setwd("~/korpm/R2/S461_results")

#Import the data and make de DF
cnames=c("thrP","REC_TPR","PREC_PPV","FPR","SP","MCC","ACC","ERR","F05","F1","F2","dist2")

KORPM <- read.table(file = "S461_KORPM_DIR_prc.txt")
CartesianΔΔG <- read.table(file = "S461_CartDD_DIR_prc.txt")
EvoFF <- read.table(file = "S461_EvoFF_DIR_prc.txt")
FoldX <- read.table(file = "S461_FoldX_DIR_prc.txt")
Dynamut2 <- read.table(file = "S461_Dynamut2_DIR_prc.txt")
DDGun3D <- read.table(file = "S461_DDgun3D_DIR_prc.txt")
ThermoNet <- read.table(file = "S461_TNet_DIR_prc.txt")
PopMusicS <- read.table(file = "S461_PopM_DIR_prc.txt")
ACDCNN <- read.table(file = "S461_ACDCNN_DIR_prc.txt")



#Define de column names
colnames(KORPM)=cnames
colnames(CartesianΔΔG)=cnames
colnames(EvoFF)=cnames
colnames(FoldX)=cnames
colnames(Dynamut2)=cnames
colnames(DDGun3D)=cnames
colnames(ThermoNet)=cnames
colnames(PopMusicS)=cnames
colnames(ACDCNN)=cnames

#Add a column with the method (for future distinguish)
KORPM<-KORPM %>%
  mutate(Method = "KORPM")
CartesianΔΔG<-CartesianΔΔG %>%
  mutate(Method = "CartesianΔΔG")
EvoFF<-EvoFF %>%
  mutate(Method = "EvoFF")
FoldX<-FoldX %>%
  mutate(Method = "FoldX")
Dynamut2<-Dynamut2 %>%
  mutate(Method = "Dynamut2")
DDGun3D<-DDGun3D %>%
  mutate(Method = "DDGun3D")
ThermoNet<-ThermoNet %>%
  mutate(Method = "ThermoNet")
PopMusicS<-PopMusicS %>%
  mutate(Method = "PopMusicS")
ACDCNN<-ACDCNN %>%
  mutate(Method = "ACDCNN")

#merge all df for a unique representation
totaldata <- rbind(KORPM,CartesianΔΔG,EvoFF,FoldX,Dynamut2,DDGun3D, ThermoNet,PopMusicS,ACDCNN)
#totaldata <- rbind(KORPM,FoldX,Dynamut2,DDGun3D, ThermoNet,PopMusicS,ACDCNN)



roc1<-ggplot(totaldata, aes(x = FPR, y = REC_TPR, group = Method, colour =Method)) +
  labs(title="ROC Direct", x="1-Specificity (FP rate)", y= "Sensitivity (TP rate)")+
  geom_smooth( stat = "identity" ) +
  scale_x_continuous(expand = c(0, 0))+
  scale_y_continuous(expand = c(0, 0))+
  expand_limits(x=c(0,1), y=c(0, 1))+
 scale_color_brewer(type="seq", palette="Paired", limits = c("KORPM","CartesianΔΔG","ACDCNN","FoldX","Dynamut2","DDGun3D", "ThermoNet","PopMusicS", "EvoFF"))+
#  scale_color_brewer(type="seq", palette="Paired", limits = c("KORPM","ACDCNN","FoldX","Dynamut2","DDGun3D", "ThermoNet","PopMusicS"))+
  
  geom_abline(slope=1, intercept=0, colour ="grey")+
  theme_bw()+
  theme(plot.margin = unit(c(20, 20, 10, 10), "pt"), 
        legend.position =  c(0.85, 0.40), legend.title=element_blank(), 
        #legend.position = "none",
        plot.title = element_text(hjust=0.5,size =12, face="bold"), 
        axis.text=element_text(size=12, face="bold"),
        axis.title=element_text(size=12, face="bold"),
        axis.title.x = element_text(margin = margin(t = 5, r = 0, b = 0, l = 0)),
        axis.title.y = element_text(margin = margin(t = 0, r = 5, b = 0, l = 0)))

print(roc1)


prc1<-ggplot(totaldata, aes(x = REC_TPR, y = PREC_PPV, group = Method, colour =Method)) +
  labs(title="Precison-Recall Curves (PRC) Direct", x= "Recall(Sensitivity)", y="Precision(PPV)")+
  geom_smooth( stat = "identity", method = "lm" ) +
  scale_x_continuous(expand = c(0, 0))+
  scale_y_continuous(expand = c(0, 0))+
  expand_limits(x=c(0,1), y=c(0, 1))+
  scale_color_brewer(type="seq", palette="Paired", limits = c("KORPM","CartesianΔΔG","ACDCNN","FoldX","Dynamut2","DDGun3D", "ThermoNet","PopMusicS", "EvoFF"))+
#  scale_color_brewer(type="seq", palette="Paired", limits = c("KORPM","ACDCNN","FoldX","Dynamut2","DDGun3D", "ThermoNet","PopMusicS"))+
  
   theme_bw()+
  theme(plot.margin = unit(c(20, 20, 10, 10), "pt"), legend.position = "none",plot.title = element_text(hjust=0.5,size =12, face="bold"), 
        axis.text=element_text(size=12, face="bold"),
        axis.title=element_text(size=12, face="bold"),
        axis.title.x = element_text(margin = margin(t = 5, r = 0, b = 0, l = 0)),
        axis.title.y = element_text(margin = margin(t = 0, r = 5, b = 0, l = 0)))

print(prc1)



plot_grid(roc1, prc1, labels = c('',''), label_size = 18, ncol = 2)
# 1050 x 1350





















