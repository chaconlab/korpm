#30/04/2021   Ivan Martin Hernandez
#Script that analize the JSON with th data of the AB PDB generated by the perl script "AB_SAbDab_sumarize.pl"

############################
# Preparation of the data

# Take the file --> "" and process it with bash command before use it

#   cat Id50c08_ok1merNCL.txt |sed 's/  */ /g' >Id50c08_ok1merNCL_2.txt
#   cat Id50c08_ok1merNCL_2.txt |cut -d " " -f1-26 > Id50c08_ok1merNCL.txt





############################





#Libraries
library(ggplot2)
library(ggpubr)
theme_set(theme_pubr())
library(dplyr)
library(stringr)
library(reshape2)
library(RColorBrewer)
library(cowplot)
library(ggpmisc)



#################
# Funciones
#################

mode <- function(x) {
  return(as.numeric(names(which.max(table(x)))))
}



# Multiple plot function
#
# ggplot objects can be passed in ..., or to plotlist (as a list of ggplot objects)
# - cols:   Number of columns in layout
# - layout: A matrix specifying the layout. If present, 'cols' is ignored.
#
# If the layout is something like matrix(c(1,2,3,3), nrow=2, byrow=TRUE),
# then plot 1 will go in the upper left, 2 will go in the upper right, and
# 3 will go all the way across the bottom.
#
multiplot <- function(..., plotlist=NULL, file, cols=1, layout=NULL) {
  library(grid)
  
  # Make a list from the ... arguments and plotlist
  plots <- c(list(...), plotlist)
  
  numPlots = length(plots)
  
  # If layout is NULL, then use 'cols' to determine layout
  if (is.null(layout)) {
    # Make the panel
    # ncol: Number of columns of plots
    # nrow: Number of rows needed, calculated from # of cols
    layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
                     ncol = cols, nrow = ceiling(numPlots/cols))
  }
  
  if (numPlots==1) {
    print(plots[[1]])
    
  } else {
    # Set up the page
    grid.newpage()
    pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))
    
    # Make each plot, in the correct location
    for (i in 1:numPlots) {
      # Get the i,j matrix positions of the regions that contain this subplot
      matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))
      
      print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
                                      layout.pos.col = matchidx$col))
    }
  }
}


corr_eqn <- function(x,y, digits = 2) {
  corr_coef <- round(cor(x, y), digits = digits)
  paste("r = ", corr_coef)
}








###########################################################
###########################################################
###########################################################
#     RESULTS PUCCI BENCHMARK
#####################*****######################################
###########################################################
###########################################################
setwd("~/korpm/korpm/Ssym_results")
setwd("~/Google Drive/DRAFTS/KORPM/FIGS/Ssym_results")
setwd("~/korpm/R2/Ssym_results")
#Import the data and make de DF
cnames=c("thrP","REC_TPR","PREC_PPV","FPR","SP","MCC","ACC","ERR","F05","F1","F2","dist2")

KORPM <- read.table(file = "KORPM_Pucci2018N_prc.txt")
KORPMF <- read.table(file = "KORPM_Pucci2018N_prcB.txt")

CartesianΔΔG <- read.table(file = "Cartddg_Pucci2018N_th8_prc.txt")
EvoFF <- read.table(file = "Evo_Pucci2018N_prc.txt")
FoldX <- read.table(file = "FoldX_Pucci2018N_th8_prc.txt")
Dynamut2 <- read.table(file = "Dynamut_Pucci2018N_prc.txt")
DDGun3D <- read.table(file = "DDGun3D_Pucci2018N_prc.txt")
ThermoNet <- read.table(file = "TherNet_Pucci2018N_prc.txt")
PopMusicS <- read.table(file = "PopMs_Pucci2018N_prc.txt")
ACDCNN <- read.table(file = "ACDCNN_Pucci2018N_prc.txt")



#Define de column names
colnames(KORPM)=cnames
colnames(KORPMF)=cnames
colnames(CartesianΔΔG)=cnames
colnames(EvoFF)=cnames
colnames(FoldX)=cnames
colnames(Dynamut2)=cnames
colnames(DDGun3D)=cnames
colnames(ThermoNet)=cnames
colnames(PopMusicS)=cnames
colnames(ACDCNN)=cnames

#Add a column with the method (for future distinguish)
KORPM<-KORPM %>%
  mutate(Method = "KORPM")
CartesianΔΔG<-CartesianΔΔG %>%
  mutate(Method = "CartesianΔΔG")
EvoFF<-EvoFF %>%
  mutate(Method = "EvoFF")
FoldX<-FoldX %>%
  mutate(Method = "FoldX")
Dynamut2<-Dynamut2 %>%
  mutate(Method = "Dynamut2")
DDGun3D<-DDGun3D %>%
  mutate(Method = "DDGun3D")
ThermoNet<-ThermoNet %>%
  mutate(Method = "ThermoNet")
PopMusicS<-PopMusicS %>%
  mutate(Method = "PopMusicS")
ACDCNN<-ACDCNN %>%
  mutate(Method = "ACDCNN")
KORPMF<-KORPMF %>%
  mutate(Method = "KORPMF")

#merge all df for a unique representation
totaldata <- rbind(KORPM,CartesianΔΔG,EvoFF,FoldX,Dynamut2,DDGun3D, ThermoNet,PopMusicS,ACDCNN)
### FIGURE 1 ######

p1<-ggplot(totaldata, aes(x = FPR, y = REC_TPR, group = Method, colour =Method)) +
  labs(title="ROC Symmetric", x="1-Specificity (FP rate)", y= "Sensitivity (TP rate)")+
  geom_smooth( stat = "identity" ) +
  scale_x_continuous(expand = c(0, 0))+
  scale_y_continuous(expand = c(0, 0))+
  expand_limits(x=c(0,1), y=c(0, 1))+
  #  scale_color_brewer(type="seq", palette="Accent")+
  scale_color_brewer(type="seq", palette="Paired", limits = c("KORPM","CartesianΔΔG","ACDCNN","FoldX","Dynamut2","DDGun3D", "ThermoNet","PopMusicS", "EvoFF"))+
  geom_abline(slope=1, intercept=0, colour ="grey")+
  theme_bw()+
  theme(plot.margin = unit(c(20, 20, 10, 10), "pt"), 
        legend.position =  c(0.85, 0.40), legend.title=element_blank(), 
        plot.title= element_blank(),
        #legend.title=element_blank(), legend.position =  "top", legend.position =  c(0.0, 1.0),
        #legend.position = "none",
        #plot.title = element_text(hjust=0.5,size =12, face="bold"), 
        axis.text=element_text(size=12, face="bold"),
        axis.title=element_text(size=12, face="bold"),
        axis.title.x = element_text(margin = margin(t = 15, r = 0, b = 0, l = 0)),
        axis.title.y = element_text(margin = margin(t = 0, r = 15, b = 0, l = 0)))

#p3 <- roc +  geom_line(data = KORPMF, aes(x = FPR, y = REC_TPR), color='#A6CEE3', linetype="dashed", size=1 )
#roc <- p1 +  geom_line(data = KORPMF, aes(x = FPR, y = REC_TPR), color='black', linetype="dotted", size=0.5 )
roc <- p1 +  geom_smooth(data = KORPMF,  stat = "identity", method = "lm", aes(x =  FPR, y = REC_TPR), color='black', linetype="dotted", size=0.5 )  

print(roc)
# 600 450 

p1 <-ggplot(totaldata, aes(x = FPR, y = REC_TPR, group = Method, colour =Method)) +
  labs(title="ROC Symmetric", x="1-Specificity (FP rate)", y= "Sensitivity (TP rate)")+
  geom_smooth( stat = "identity" ) +
  scale_x_continuous(expand = c(0, 0))+
  scale_y_continuous(expand = c(0, 0))+
  expand_limits(x=c(0,1), y=c(0, 1))+
  #  scale_color_brewer(type="seq", palette="Accent")+
  scale_color_brewer(type="seq", palette="Paired", limits = c("KORPM","CartesianΔΔG","ACDCNN","FoldX","Dynamut2","DDGun3D", "ThermoNet","PopMusicS", "EvoFF"))+
  geom_abline(slope=1, intercept=0, colour ="grey")+
  theme_bw()+
  theme(plot.margin = unit(c(20, 20, 10, 10), "pt"), 
        #legend.position =  c(0.85, 0.40), legend.title=element_blank(), 
        # plot.title= element_blank(),
        #legend.title=element_blank(), legend.position =  "top", legend.position =  c(0.0, 1.0),
        legend.position = "none",
        plot.title = element_text(hjust=0.5,size =12, face="bold"), 
        axis.text=element_text(size=12, face="bold"),
        axis.title=element_text(size=12, face="bold"),
        axis.title.x = element_text(margin = margin(t = 15, r = 0, b = 0, l = 0)),
        axis.title.y = element_text(margin = margin(t = 0, r = 15, b = 0, l = 0)))
#roc0 <- p1 +  geom_smooth(data = KORPMF,  stat = "identity", method = "lm", aes(x =  FPR, y = REC_TPR), color='black', linetype="dotted", size=0.5 )  
roc0 <- p1

print(roc0)

p1 <-ggplot(totaldata, aes(x = REC_TPR, y = PREC_PPV, group = Method, colour =Method)) +
  labs(title="Precison-Recall Curves (PRC) Symmetric", x= "Recall(Sensitivity)", y="Precision(PPV)")+
  geom_smooth( stat = "identity", method = "lm" ) +
  scale_x_continuous(expand = c(0, 0))+
  scale_y_continuous(expand = c(0, 0))+
  expand_limits(x=c(0,1), y=c(0, 1))+
  #  scale_color_brewer(type="seq", palette="Accent")+
  scale_color_brewer(type="seq", palette="Paired", limits = c("KORPM","CartesianΔΔG","ACDCNN","FoldX","Dynamut2","DDGun3D", "ThermoNet","PopMusicS", "EvoFF"))+
  theme_bw()+
  theme(plot.margin = unit(c(20, 20, 10, 10), "pt"), legend.position = "none", plot.title = element_text(hjust=0.5,size =12, face="bold"), 
        axis.text=element_text(size=12, face="bold"),
        axis.title=element_text(size=12, face="bold"),
        axis.title.x = element_text(margin = margin(t = 15, r = 0, b = 0, l = 0)),
        axis.title.y = element_text(margin = margin(t = 0, r = 15, b = 0, l = 0)))
prc0 <- p1 

prc <- prc0 +  geom_smooth(data = KORPMF,  stat = "identity", method = "lm", aes(x = REC_TPR, y = PREC_PPV), color='black', linetype="dotted", size=0.5 )  

print(prc)

plot_grid(roc, prc,  labels = c('A', 'B'), label_size = 18, ncol = 2)




#     RESULTS PUCCI  DIRECT

#Import the data and make de DF
cnames=c("thrP","REC_TPR","PREC_PPV","FPR","SP","MCC","ACC","ERR","F05","F1","F2","dist2")

KORPM <- read.table(file = "KORPM_Pucci2018dirN_prc.txt")
KORPMF <- read.table(file = "KORPM_Pucci2018dirN_prcB.txt")

CartesianΔΔG <- read.table(file = "Cartddg_Pucci2018dirN_th8_prc.txt")
EvoFF <- read.table(file = "Evo_Pucci2018dirN_prc.txt")
FoldX <- read.table(file = "FoldX_Pucci2018dirN_th8_prc.txt")
Dynamut2 <- read.table(file = "Dynamut_Pucci2018dirN_prc.txt")
DDGun3D <- read.table(file = "DDGun3D_Pucci2018dirN_prc.txt")
ThermoNet <- read.table(file = "TherNet_Pucci2018dirN_prc.txt")
PopMusicS <- read.table(file = "PopMs_Pucci2018dirN_prc.txt")
ACDCNN <- read.table(file = "ACDCNN_Pucci2018dirN_prc.txt")

#Define de column names
colnames(KORPM)=cnames
colnames(CartesianΔΔG)=cnames
colnames(EvoFF)=cnames
colnames(FoldX)=cnames
colnames(Dynamut2)=cnames
colnames(DDGun3D)=cnames
colnames(ThermoNet)=cnames
colnames(PopMusicS)=cnames
colnames(ACDCNN)=cnames
colnames(KORPMF)=cnames

#Add a column with the method (for future distinguish)
KORPM<-KORPM %>%
  mutate(Method = "KORPM")
CartesianΔΔG<-CartesianΔΔG %>%
  mutate(Method = "CartesianΔΔG")
EvoFF<-EvoFF %>%
  mutate(Method = "EvoFF")
FoldX<-FoldX %>%
  mutate(Method = "FoldX")
Dynamut2<-Dynamut2 %>%
  mutate(Method = "Dynamut2")
DDGun3D<-DDGun3D %>%
  mutate(Method = "DDGun3D")
ThermoNet<-ThermoNet %>%
  mutate(Method = "ThermoNet")
PopMusicS<-PopMusicS %>%
  mutate(Method = "PopMusicS")
ACDCNN<-ACDCNN %>%
  mutate(Method = "ACDCNN")
KORPMF<-KORPMF %>%
  mutate(Method = "KORPMF")


#merge all df for a unique representation
totaldata <- rbind(KORPM,CartesianΔΔG,EvoFF,FoldX,Dynamut2,DDGun3D, ThermoNet,PopMusicS,ACDCNN)



p1<-ggplot(totaldata, aes(x = FPR, y = REC_TPR, group = Method, colour =Method)) +
  labs(title="ROC Direct", x="1-Specificity (FP rate)", y= "Sensitivity (TP rate)")+
  geom_smooth( stat = "identity" ) +
  scale_x_continuous(expand = c(0, 0))+
  scale_y_continuous(expand = c(0, 0))+
  expand_limits(x=c(0,1), y=c(0, 1))+
  scale_color_brewer(type="seq", palette="Paired", limits = c("KORPM","CartesianΔΔG","ACDCNN","FoldX","Dynamut2","DDGun3D", "ThermoNet","PopMusicS", "EvoFF"))+
  geom_abline(slope=1, intercept=0, colour ="grey")+
  theme_bw()+
  theme(plot.margin = unit(c(20, 20, 10, 10), "pt"), 
        #legend.position =  c(0.85, 0.40), legend.title=element_blank(), 
        #legend.title=element_blank(), legend.position =  "right",
        legend.position = "none",
        plot.title = element_text(hjust=0.5,size =12, face="bold"), 
        axis.text=element_text(size=12, face="bold"),
        axis.title=element_text(size=12, face="bold"),
        axis.title.x = element_text(margin = margin(t = 5, r = 0, b = 0, l = 0)),
        axis.title.y = element_text(margin = margin(t = 0, r = 5, b = 0, l = 0)))
#roc1 <- p1 +  geom_smooth(data = KORPMF,  stat = "identity", method = "lm", aes(x =  FPR, y = REC_TPR), color='black', linetype="dotted", size=0.5 )  
roc1 <- p1 

print(roc1)


p1<-ggplot(totaldata, aes(x = REC_TPR, y = PREC_PPV, group = Method, colour =Method)) +
  labs(title="Precison-Recall Curves (PRC) Direct", x= "Recall(Sensitivity)", y="Precision(PPV)")+
  geom_smooth( stat = "identity", method = "lm" ) +
  scale_x_continuous(expand = c(0, 0))+
  scale_y_continuous(expand = c(0, 0))+
  expand_limits(x=c(0,1), y=c(0, 1))+
  scale_color_brewer(type="seq", palette="Paired", limits = c("KORPM","CartesianΔΔG","ACDCNN","FoldX","Dynamut2","DDGun3D", "ThermoNet","PopMusicS", "EvoFF"))+
  theme_bw()+
  theme(plot.margin = unit(c(20, 20, 10, 10), "pt"),
        #legend.position =  c(0.85, 0.40), legend.title=element_blank(), 
        legend.position = "none",
        plot.title = element_text(hjust=0.5,size =12, face="bold"), 
        axis.text=element_text(size=12, face="bold"),
        axis.title=element_text(size=12, face="bold"),
        axis.title.x = element_text(margin = margin(t = 5, r = 0, b = 0, l = 0)),
        axis.title.y = element_text(margin = margin(t = 0, r = 5, b = 0, l = 0)))
#prc1 <- p1 +  geom_smooth(data = KORPMF,  stat = "identity", method = "lm", aes(x = REC_TPR, y = PREC_PPV), color='black', linetype="dotted", size=0.5 )  
prc1 <- p1 

print(prc1)


#     RESULTS PUCCI BENCHMARK INDIRECT


#Import the data and make de DF
cnames=c("thrP","REC_TPR","PREC_PPV","FPR","SP","MCC","ACC","ERR","F05","F1","F2","dist2")

KORPM <- read.table(file = "KORPM_Pucci2018revN_prc.txt")
KORPMF <- read.table(file = "KORPM_Pucci2018revN_prcB.txt")

CartesianΔΔG <- read.table(file = "Cartddg_Pucci2018revN_th8_prc.txt")
EvoFF <- read.table(file = "Evo_Pucci2018revN_prc.txt")
FoldX <- read.table(file = "FoldX_Pucci2018revN_th8_prc.txt")
Dynamut2 <- read.table(file = "Dynamut_Pucci2018revN_prc.txt")
DDGun3D <- read.table(file = "DDGun3D_Pucci2018revN_prc.txt")
ThermoNet <- read.table(file = "TherNet_Pucci2018revN_prc.txt")
PopMusicS<- read.table(file = "PopMs_Pucci2018revN_prc.txt")
ACDCNN <- read.table(file = "ACDCNN_Pucci2018revN_prc.txt")


#Define de column names
colnames(KORPM)=cnames
colnames(KORPMF)=cnames

colnames(CartesianΔΔG)=cnames
colnames(EvoFF)=cnames
colnames(FoldX)=cnames
colnames(Dynamut2)=cnames
colnames(DDGun3D)=cnames
colnames(ThermoNet)=cnames
colnames(PopMusicS)=cnames
colnames(ACDCNN)=cnames

#Add a column with the method (for future distinguish)
KORPM<-KORPM %>%
  mutate(Method = "KORPM")

CartesianΔΔG<-CartesianΔΔG %>%
  mutate(Method = "CartesianΔΔG")
EvoFF<-EvoFF %>%
  mutate(Method = "EvoFF")
FoldX<-FoldX %>%
  mutate(Method = "FoldX")
Dynamut2<-Dynamut2 %>%
  mutate(Method = "Dynamut2")
DDGun3D<-DDGun3D %>%
  mutate(Method = "DDGun3D")
ThermoNet<-ThermoNet %>%
  mutate(Method = "ThermoNet")
PopMusicS<-PopMusicS %>%
  mutate(Method = "PopMusicS")
ACDCNN<-ACDCNN %>%
  mutate(Method = "ACDCNN")
KORPMF<-KORPMF %>%
  mutate(Method = "KORPMF")
#merge all df for a unique representation
totaldata <- rbind(KORPM,CartesianΔΔG,EvoFF,FoldX,Dynamut2,DDGun3D, ThermoNet,PopMusicS,ACDCNN)


p1<-ggplot(totaldata, aes(x = FPR, y = REC_TPR, group = Method,  colour =Method)) +
  labs(title="ROC Reverse", x="1-Specificity (FP rate)", y= "Sensitivity (TP rate)")+
  geom_smooth( stat = "identity" ) +
  scale_x_continuous(expand = c(0, 0))+
  scale_y_continuous(expand = c(0, 0))+
  expand_limits(x=c(0,1), y=c(0, 1))+
  geom_abline(slope=1, intercept=0, colour ="grey")+
  scale_color_brewer(type="seq", palette="Paired", limits = c("KORPM","CartesianΔΔG","ACDCNN","FoldX","Dynamut2","DDGun3D", "ThermoNet","PopMusicS", "EvoFF"))+
  theme_bw()+
  theme(plot.margin = unit(c(20, 20, 10, 10), "pt"), 
       # legend.title=element_blank(),  legend.key.size =unit(1, 'cm'), legend.justification=c(0.5,0.6), legend.position =  c(0.85, 0.50),
       #legend.title=element_blank(), legend.position =  "top",
       legend.position = "none",
        plot.title = element_text(hjust=0.5,size =12, face="bold"), 
        axis.text=element_text(size=12, face="bold"),
        axis.title=element_text(size=12, face="bold"),
        axis.title.x = element_text(margin = margin(t = 5, r = 0, b = 0, l = 0)),
        axis.title.y = element_text(margin = margin(t = 0, r = 5, b = 0, l = 0)))
#roc2 <- p1 +  geom_smooth(data = KORPMF,  stat = "identity", method = "lm", aes(x =  FPR, y = REC_TPR), color='black', linetype="dotted", size=0.5 )  
roc2 <- p1 
print(roc2)


p1<-ggplot(totaldata, aes(x = REC_TPR, y = PREC_PPV, group = Method, colour =Method)) +
  labs(title="Precison-Recall Curves (PRC) Reverse", x= "Recall(Sensitivity)", y="Precision(PPV)")+
  geom_smooth( stat = "identity", method = "lm" ) +
  scale_x_continuous(expand = c(0, 0))+
  scale_y_continuous(expand = c(0, 0))+
  expand_limits(x=c(0,1), y=c(0, 1))+
  scale_color_brewer(type="seq", palette="Paired", limits = c("KORPM","CartesianΔΔG","ACDCNN","FoldX","Dynamut2","DDGun3D", "ThermoNet","PopMusicS", "EvoFF"))+
  theme_bw()+
  theme(plot.margin = unit(c(20, 20, 10, 10), "pt"), legend.position = "none", plot.title = element_text(hjust=0.5,size =12, face="bold"), 
        axis.text=element_text(size=12, face="bold"),
        axis.title=element_text(size=12, face="bold"),
        axis.title.x = element_text(margin = margin(t = 5, r = 0, b = 0, l = 0)),
        axis.title.y = element_text(margin = margin(t = 0, r = 5, b = 0, l = 0)))
#prc2 <- p1 +  geom_smooth(data = KORPMF,  stat = "identity", method = "lm", aes(x = REC_TPR, y = PREC_PPV), color='black', linetype="dotted", size=0.5 )  
prc2 <- p1 
print(prc2)




plot_grid(roc0, prc0,roc1, prc1,roc2, prc2, labels = c('A', '','B', '', 'C', ''), label_size = 18, ncol = 2)
# 1050 x 1350



###########################################################
#     RESULTS PUCCI BENCHMARK symmetry
###########################################################


#Import the data and make de DF
cnames=c("PDBd","PDBr","Mutd","Muti","Exp","Dir","Rev","D","Dabs","Class")
cnamesK=c("PDBd","PDBr","Mutd","Exp","Dir","Rev","D","Dabs","AAfrom","AAto")


sym_KORPM <- read.table(file = "KORPM_Pucci2018_sym.txt")
sym_CartesianddG <- read.table(file = "Cartddg_Pucci2018_th8_sym.txt")
sym_Evo <- read.table(file = "Evo_Pucci2018_sym.txt")
sym_FoldX <- read.table(file = "FoldX_Pucci2018_th8_sym.txt")
sym_Dynamut <- read.table(file = "Dynamut_Pucci2018_sym.txt")
sym_DDGun <- read.table(file = "DDGun3D_Pucci2018_sym.txt")
sym_TherNet <- read.table(file = "TherNet_Pucci2018_sym.txt")
sym_PopMs<- read.table(file = "PopMs_Pucci2018_sym.txt")
sym_ACDCNN<- read.table(file = "ACDCNN_Pucci2018_sym.txt")



#Define de column names
colnames(sym_KORPM)=cnamesK
colnames(sym_CartesianddG)=cnames
colnames(sym_Evo)=cnames
colnames(sym_FoldX)=cnames
colnames(sym_Dynamut)=cnames
colnames(sym_DDGun)=cnames
colnames(sym_TherNet)=cnames
colnames(sym_PopMs)=cnames
colnames(sym_ACDCNN)=cnames









fiN = c("KORPM_Pucci2018","Cartddg_Pucci2018_th8","ACDCNN_Pucci2018","FoldX_Pucci2018_th8","Dynamut_Pucci2018","DDGun3D_Pucci2018", "TherNet_Pucci2018","PopMs_Pucci2018","Evo_Pucci2018")

metodos =  c("KORPM","CartesianΔΔG","ACDCNN","FoldX","Dynamut2","DDGun3D", "ThermoNet","PopMusicS", "EvoFF")


pl <- list()  # new empty plot list

for (i in 1:length(fiN)) {
  file = sprintf("%s_sym.txt", fiN[i])
  symchart = sprintf("sym%d",i )
  output = sprintf("-> processing %s", metodos[i])
  print(output)
  # read file
  sym <- read.table(file)
  #Define de column names
  colnames(sym)=cnames
  #Plot
  symchart<-ggplot(sym, aes(x = Dir, y = Rev)) +
    labs( x= "Direct ΔΔG (Kcal/mol)", y="Reverse ΔΔG (Kcal/mol)")+
    geom_jitter( stat = "identity" , colour="blue", size = 2) +
    scale_x_continuous(expand = c(0, 0))+
    scale_y_continuous(expand = c(0, 0))+
    expand_limits(x=c(0,1), y=c(0, 1))+
    geom_abline(slope=-1, intercept=-1, colour ="#b2b2b2",linetype="dashed")+
    geom_abline(slope=-1, intercept=1, colour ="#b2b2b2",linetype="dashed")+
    geom_abline(slope=-1, intercept=0, colour ="black")+
    annotate("text_npc",npcx = 0.9, npcy = 0.95, label = metodos[i] ,size = 6)+
    annotate("text_npc",npcx = 0.9, npcy = 0.90, label = corr_eqn(sym$Dir,sym$Rev),size = 6)+
#    stat_cor( method = "pearson", aes(x = Dir, y = Rev), label.x.npc = 0.6, label.y.npc = 0.90, digits = 2, colour="deepskyblue3",  r.accuracy = NULL)
    theme_bw()+
    theme(plot.margin = unit(c(20, 20, 10, 10), "pt"), plot.title = element_text(hjust=0.5,size =18),axis.ticks = element_blank(), 
          axis.text=element_text(size=12,face="bold"),
          axis.title=element_text(size=14),
          axis.title.x = element_text(margin = margin(t = 5, r = 0, b = 0, l = 0)),
          axis.title.y = element_text(margin = margin(t = 0, r = 5, b = 0, l = 0)))
  #print(symchart)
  pl[[i]] <-   symchart # add each plot into plot list
  

  
  
}

#print(pl[[1]])

plot_grid(plotlist = pl, labels = "AUTO", label_size = 18, ncol = 3)
# 1400 x 1800 FigS6


fiN2 = c("KORPM_Pucci2018N","Cartddg_Pucci2018N_th8","ACDCNN_Pucci2018N","FoldX_Pucci2018N_th8","Dynamut_Pucci2018N","DDGun3D_Pucci2018N", 
         "TherNet_Pucci2018N","PopMs_Pucci2018N","Evo_Pucci2018N")

pl <- list()  # new empty plot list

for (i in 1:length(fiN)) {
#  for (i in 1:1) {
    
  file = sprintf("%s_sym.txt", fiN[i])
  output = sprintf("-> processing %s", metodos[i])
  print(output)
  # read file
  sym <- read.table(file)
  
  file = sprintf("%s.txt", fiN2[i])
  sym2 <- read.table(file)
  
  if (i==1) {
  sym2$V3 <- sym2$V10  
  sym2$V4 <- sym2$V11  
  output = sprintf("-> changing %s", metodos[i])
  print(output)
  }
  #Define de column names
  colnames(sym)=cnames
  #Plot
  symchart<-ggplot(data=sym2, aes(x = V3, y = V4) ) + 
    # ggplot(data=sym2, aes(x = V3, y = V4, colour = factor(sign(V4))) ) + 
    #geom_point(data = sym, aes(x =  Exp, y = Dir), colour="blue", fill = "red") +
    geom_point(data = sym, aes(x = -Exp, y = Rev), colour="deepskyblue3", fill = "red") +
    
    #scale_colour_manual(values = c("blue", "blue", "cyan"), breaks = c("-1", "0", "1")) +
    
    
    labs( x= "Experimental ΔΔG (Kcal/mol)", y="Calculated ΔΔG (Kcal/mol)")+
    geom_jitter( stat = "identity" , colour="blue") +
    scale_x_continuous(expand = c(0, 0),breaks=seq(-8.0,8.0,1.0) )+
    scale_y_continuous(expand = c(0, 0), breaks=seq(-8.0,14.0,1.0), limits=c(-8.00, 8.00) )+
#   xlim(-5.01, 5.01) +
#    ylim(-8.01, 8.01) +
#    stat_cor( aes(x = Exp, y = Dir), label.x.npc = 0.1, label.y.npc = 0.88, digits = 2,  colour="blue", r.accuracy = NULL ) +
#    stat_cor( aes(x = -Exp, y = Rev), label.x.npc = 0.1, label.y.npc = 0.84, digits = 2, colour="deepskyblue3",  r.accuracy = NULL) +
     stat_cor( aes(x = V3, y = V4), label.x.npc = 0.1, label.y.npc = 0.84, digits = 3, colour="black",  r.accuracy = NULL) +
    geom_smooth(method = "lm") +
    
     geom_vline(xintercept = 0, colour="grey") + geom_hline(yintercept = 0,  colour="grey") +
    expand_limits(x=c(0,1), y=c(0, 1))+
    annotate("text_npc",npcx = 0.1, npcy = 0.95, label = metodos[i] ,size = 6)+
    theme_bw()+
    theme(plot.margin = unit(c(20, 20, 10, 10), "pt"), plot.title = element_text(hjust=0.5,size =18),axis.ticks = element_blank(), 
          axis.text=element_text(size=12,face="bold"),
          axis.title=element_text(size=14),
          axis.title.x = element_text(margin = margin(t = 5, r = 0, b = 0, l = 0)),
          axis.title.y = element_text(margin = margin(t = 0, r = 5, b = 0, l = 0)))
  pl[[i]] <-   symchart # add each plot into plot list
  
  # print(symchart)
  
}


plot_grid(plotlist = pl, labels = "AUTO", label_size = 18, ncol = 3)
# figs3 1400x1600
#
#  just KORPM -- FIG 2
#

i = 1

file = sprintf("%s_sym.txt", fiN[i])
output = sprintf("-> processing %s", metodos[i])
print(symchart)
print(output)
# read file
sym <- read.table(file)
#Define de column names
colnames(sym)=cnames


#Plot
symchart<-ggplot(sym, aes(x = Dir, y = Rev)) +
  labs( x= "Direct ΔΔG (Kcal/mol)", y="Reverse ΔΔG (Kcal/mol)")+
  geom_jitter( stat = "identity" , colour="blue") +
  # scale_x_continuous(expand = c(0, 0),breaks=seq(-4.0,4.0,1.0) )+
  # xlim(-4.01, 4.01) +
  scale_y_continuous(expand = c(0, 0))+
  scale_x_continuous(expand = c(0, 0))+
  # xlim(-5.01, 3.01) + ylim(-3.01, 5.01) +
  expand_limits(x=c(0,1), y=c(0, 1))+
  
  geom_abline(slope=-1, intercept=-1, colour ="#b2b2b2",linetype="dashed")+
  geom_abline(slope=-1, intercept=1, colour ="#b2b2b2",linetype="dashed")+
  geom_abline(slope=-1, intercept=0, colour ="black")+
  # annotate("text_npc",npcx = 0.9, npcy = 0.95, label = metodos[i] ,size = 6)+
  #   annotate("text_npc",npcx = 0.9, npcy = 0.90, label = corr_eqn(sym$Dir,sym$Rev),size = 6)+
  theme_bw()+
  theme(plot.margin = unit(c(20, 20, 10, 10), "pt"), plot.title = element_text(hjust=0.5,size =18), 
        axis.text=element_text(size=12,face="bold"),
        axis.title=element_text(size=14),
        axis.title.x = element_text(margin = margin(t = 5, r = 0, b = 0, l = 0)),
        axis.title.y = element_text(margin = margin(t = 0, r = 5, b = 0, l = 0)))
print(symchart)
# 600x 450 fig2

# alternative  FIG 2
KORPMsym <-   symchart # add each plot into plot list

#Plot
symchart<-ggplot(sym, aes(x = Exp, y = Dir)) +
  geom_point(data = sym, aes(x = -Exp, y = Rev), colour="deepskyblue3", fill = "white") +
  labs( x= "Experimental ΔΔG (Kcal/mol)", y="Calculated ΔΔG (Kcal/mol)")+
  geom_jitter( stat = "identity" , colour="blue") +
  scale_x_continuous(expand = c(0, 0),breaks=seq(-8.0,8.0,1.0) )+
  scale_y_continuous(expand = c(0, 0) )+
  # xlim(-5.01, 5.01) +
  ylim(-5.01, 3.01) +
  #    stat_cor( aes(x = Exp, y = Dir), label.x.npc = 0.1, label.y.npc = 0.88, digits = 2,  colour="blue", r.accuracy = NULL ) +
  #    stat_cor( aes(x = -Exp, y = Rev), label.x.npc = 0.1, label.y.npc = 0.84, digits = 2, colour="deepskyblue3",  r.accuracy = NULL) +
  
  expand_limits(x=c(0,1), y=c(0, 1))+
#  annotate("text_npc",npcx = 0.1, npcy = 0.95, label = metodos[i] ,size = 6)+
  theme_bw()+
  theme(plot.margin = unit(c(20, 20, 10, 10), "pt"), plot.title = element_text(hjust=0.5,size =18), 
        axis.text=element_text(size=12,face="bold"),
        axis.title=element_text(size=14),
        axis.title.x = element_text(margin = margin(t = 5, r = 0, b = 0, l = 0)),
        axis.title.y = element_text(margin = margin(t = 0, r = 5, b = 0, l = 0)))
print(symchart)

KORPMopt <-   symchart # add each plot into plot list








plot_grid(KORPMopt, KORPMsym,  labels = c('A', 'B'), label_size = 18, ncol = 2)






















